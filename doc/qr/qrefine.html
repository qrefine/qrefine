<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>Quantum|Refinement: final-stage refinement with restraints from Quantum Chemistry.</title>

    <link rel="stylesheet" type="text/css" href="../css/html4css1.css" />
    <link rel="stylesheet" type="text/css" href="../css/stylesheet.css" />

  </head>
  <body>

    <div id="header">
      <a href="../qr.html">
        <img src="../icons/qr-logo-small.jpg" alt="Q|Refinement" />
        <span>
          <strong>Q|R</strong>efinement
        </span>
      </a>
    </div>

    <div class="document" id="quantum-refinement-final-stage-refinement-with-restraints-from-quantum-chemistry">
<h1 class="title">Quantum|Refinement: final-stage refinement with restraints from Quantum Chemistry.</h1>
<div class="section" id="authors">
<h1>Authors</h1>
<p>Min Zheng, Pavel Afonine, Mark Waller, Nigel Moriarty</p>
</div>
<div class="section" id="purpose">
<h1>Purpose</h1>
<p><tt class="docutils literal">qr.refine</tt> is a command line tool for refining bio-macromolecules using restraints from Quantum Chemistry (QM).</p>
</div>
<div class="section" id="usage">
<h1>Usage</h1>
<p>Q|R is a new open-source module that carries out refinement of bio-macromolecules.
To maintain a small and agile code-base, qr is built on top of cctbx and Terachem.
The cctbx library provides most of the routines needed for x-ray refinement.
The key feature of the qr code is that it interfaces to Terachem to obtain
chemical restraints using ab initio methods.</p>
<p>In principle, <tt class="docutils literal">qr.refine</tt> only needs a data file (e.g. mtz) and a model (e.g. pdb):</p>
<pre class="literal-block">
qr.refine input.pdb input.mtz
</pre>
<p>Sensible default options are selected and can be viewed with <tt class="docutils literal">qr.refine <span class="pre">--defaults</span></tt></p>
</div>
<div class="section" id="examples">
<h1>Examples</h1>
<p>The default restraints are the classical cctbx. These restraints are taken from the parameterized library.</p>
</div>
<div class="section" id="qm-interface">
<h1>QM interface</h1>
<p><a class="reference external" href="qm_interfaces.html">List of QM interfaces</a></p>
</div>
<div class="section" id="examples-and-tips">
<h1>Examples and Tips</h1>
<p><a class="reference external" href="gtest.html">checking the gradient from the clustering approach</a></p>
</div>
<div class="section" id="literature">
<h1>Literature</h1>
<p><a class="reference external" href="https://journals.iucr.org/d/issues/2017/01/00/lp5021/lp5021.pdf">https://journals.iucr.org/d/issues/2017/01/00/lp5021/lp5021.pdf</a></p>
<p><a class="reference external" href="https://journals.iucr.org/d/issues/2017/12/00/lp5024/lp5024.pdf">https://journals.iucr.org/d/issues/2017/12/00/lp5024/lp5024.pdf</a></p>
<div class="section" id="list-of-all-available-keywords">
<h2>List of all available keywords</h2>
<p><ul class="phil"><li class="phil-param" data-expert="0"><span class="phil-name">max_atoms</span><span class="phil-words"> = 15000 </span><span class="phil-help">maximum number of atoms</span></li><li class="phil-param" data-expert="0"><span class="phil-name">debug</span><span class="phil-words"> = False </span><span class="phil-help">flag to control verbosity of output for debugging problematic code.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">restraints</span><span class="phil-words"> = cctbx *qm </span></li><li class="phil-param" data-expert="0"><span class="phil-name">output_file_name_prefix</span><span class="phil-words"> = None </span></li><li class="phil-param" data-expert="0"><span class="phil-name">output_folder_name</span><span class="phil-words"> = "pdb" </span></li><li class="phil-param" data-expert="0"><span class="phil-name">shared_disk</span><span class="phil-words"> = True </span><span class="phil-help">this is deprecated no because we now only use the parallel map.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">rst_file</span><span class="phil-words"> = None </span><span class="phil-help">Restart file to use for determining location in run. Loads previous results of weight calculations.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">dump_gradients</span><span class="phil-words"> = None </span><span class="phil-help">used for debugging gradients when clustering.</span></li><li class="phil-param phil-scope" data-expert="0"><span class="phil-name">input</span><ul><li class="phil-param" data-expert="0"><span class="phil-name">sequence</span><span class="phil-words"> = None </span></li><li class="phil-param" data-expert="0"><span class="phil-name">scattering_table</span><span class="phil-words"> = wk1995 it1992 *n_gaussian neutron electron </span></li><li class="phil-param" data-expert="0"><span class="phil-name">wavelength</span><span class="phil-words"> = None </span></li><li class="phil-param" data-expert="0"><span class="phil-name">energy</span><span class="phil-words"> = None </span></li><li class="phil-param" data-expert="0"><span class="phil-name">twin_law</span><span class="phil-words"> = Auto </span><span class="phil-help">Enter twin law if known.</span></li><li class="phil-param phil-scope" data-expert="0"><span class="phil-name">xray_data</span><span class="phil-help">Scope of X-ray data and free-R flags</span><ul><li class="phil-param" data-expert="0"><span class="phil-name">file_name</span><span class="phil-words"> = None </span></li><li class="phil-param" data-expert="0"><span class="phil-name">labels</span><span class="phil-words"> = None </span></li><li class="phil-param" data-expert="0"><span class="phil-name">high_resolution</span><span class="phil-words"> = None </span></li><li class="phil-param" data-expert="0"><span class="phil-name">low_resolution</span><span class="phil-words"> = None </span></li><li class="phil-param" data-expert="0"><span class="phil-name">outliers_rejection</span><span class="phil-words"> = True </span><span class="phil-help">Remove basic wilson outliers , extreme wilson outliers , and beamstop shadow outliers</span></li><li class="phil-param" data-expert="0"><span class="phil-name">french_wilson_scale</span><span class="phil-words"> = True </span></li><li class="phil-param" data-expert="0"><span class="phil-name">sigma_fobs_rejection_criterion</span><span class="phil-words"> = None </span></li><li class="phil-param" data-expert="0"><span class="phil-name">sigma_iobs_rejection_criterion</span><span class="phil-words"> = None </span></li><li class="phil-param" data-expert="1"><span class="phil-name">ignore_all_zeros</span><span class="phil-words"> = True </span></li><li class="phil-param" data-expert="1"><span class="phil-name">force_anomalous_flag_to_be_equal_to</span><span class="phil-words"> = None </span></li><li class="phil-param" data-expert="2"><span class="phil-name">convert_to_non_anomalous_if_ratio_pairs_lone_less_than_threshold</span><span class="phil-words"> = 0.5 </span></li><li class="phil-param phil-scope" data-expert="0"><span class="phil-name">french_wilson</span><ul><li class="phil-param" data-expert="0"><span class="phil-name">max_bins</span><span class="phil-words"> = 60 </span><span class="phil-help">Maximum number of resolution bins</span></li><li class="phil-param" data-expert="0"><span class="phil-name">min_bin_size</span><span class="phil-words"> = 40 </span><span class="phil-help">Minimum number of reflections per bin</span></li></ul></li><li class="phil-param phil-scope" data-expert="0"><span class="phil-name">r_free_flags</span><ul><li class="phil-param" data-expert="0"><span class="phil-name">file_name</span><span class="phil-words"> = None </span><span class="phil-help">This is normally the same as the file containing Fobs and is usually selected automatically.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">label</span><span class="phil-words"> = None </span></li><li class="phil-param" data-expert="0"><span class="phil-name">test_flag_value</span><span class="phil-words"> = None </span><span class="phil-help">This value is usually selected automatically - do not change unless you really know what you're doing!</span></li><li class="phil-param" data-expert="0"><span class="phil-name">ignore_r_free_flags</span><span class="phil-words"> = False </span><span class="phil-help">Use all reflections in refinement (work and test)</span></li><li class="phil-param" data-expert="2"><span class="phil-name">disable_suitability_test</span><span class="phil-words"> = False </span></li><li class="phil-param" data-expert="2"><span class="phil-name">ignore_pdb_hexdigest</span><span class="phil-words"> = False </span><span class="phil-help">If True, disables safety check based on MD5 hexdigests stored in PDB files produced by previous runs.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">generate</span><span class="phil-words"> = False </span><span class="phil-help">Generate R-free flags (if not available in input files)</span></li><li class="phil-param" data-expert="0"><span class="phil-name">fraction</span><span class="phil-words"> = 0.1 </span></li><li class="phil-param" data-expert="2"><span class="phil-name">max_free</span><span class="phil-words"> = 2000 </span></li><li class="phil-param" data-expert="2"><span class="phil-name">lattice_symmetry_max_delta</span><span class="phil-words"> = 5 </span></li><li class="phil-param" data-expert="0"><span class="phil-name">use_lattice_symmetry</span><span class="phil-words"> = True </span></li><li class="phil-param" data-expert="0"><span class="phil-name">use_dataman_shells</span><span class="phil-words"> = False </span><span class="phil-help">Used to avoid biasing of the test set by certain types of non-crystallographic symmetry.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">n_shells</span><span class="phil-words"> = 20 </span></li></ul></li></ul></li><li class="phil-param phil-scope" data-expert="0"><span class="phil-name">pdb</span><ul><li class="phil-param" data-expert="0"><span class="phil-name">file_name</span><span class="phil-words"> = None </span><span class="phil-help">Model file(s) name (PDB)</span></li></ul></li><li class="phil-param phil-scope" data-expert="0"><span class="phil-name">monomers</span><ul><li class="phil-param" data-expert="0"><span class="phil-name">file_name</span><span class="phil-words"> = None </span><span class="phil-help">Monomer file(s) name (CIF)</span></li></ul></li><li class="phil-param phil-scope" data-expert="0"><span class="phil-name">maps</span><ul><li class="phil-param" data-expert="0"><span class="phil-name">map_file_name</span><span class="phil-words"> = None </span><span class="phil-help">A CCP4-formatted map</span></li><li class="phil-param" data-expert="0"><span class="phil-name">d_min</span><span class="phil-words"> = None </span><span class="phil-help">Resolution of map</span></li><li class="phil-param" data-expert="0"><span class="phil-name">map_coefficients_file_name</span><span class="phil-words"> = None </span><span class="phil-help">MTZ file containing map</span></li><li class="phil-param" data-expert="0"><span class="phil-name">map_coefficients_label</span><span class="phil-words"> = None </span><span class="phil-help">Data label for complex map coefficients in MTZ file</span></li></ul></li></ul></li><li class="phil-param phil-scope" data-expert="0"><span class="phil-name">cluster</span><ul><li class="phil-param" data-expert="0"><span class="phil-name">charge_cutoff</span><span class="phil-words"> = 8.0 </span><span class="phil-help">distance for point charge cutoff</span></li><li class="phil-param" data-expert="0"><span class="phil-name">clustering</span><span class="phil-words"> = False </span><span class="phil-help">enable/disable clustering</span></li><li class="phil-param" data-expert="0"><span class="phil-name">charge_embedding</span><span class="phil-words"> = False </span><span class="phil-help">point charge embedding</span></li><li class="phil-param" data-expert="0"><span class="phil-name">two_buffers</span><span class="phil-words"> = False </span><span class="phil-help">two-buffers are used when gradients for the whole system do not match the joined gradients from fragments when only as single buffer was used to surround each clusters.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">maxnum_residues_in_cluster</span><span class="phil-words"> = 15 </span><span class="phil-help">maximum number of residues in a cluster</span></li><li class="phil-param" data-expert="0"><span class="phil-name">clustering_method</span><span class="phil-words"> = gnc *bcc </span><span class="phil-help">type of clustering algorithm</span></li><li class="phil-param" data-expert="0"><span class="phil-name">altloc_method</span><span class="phil-words"> = *average subtract </span><span class="phil-help">two strategies on how to join energies from multiple energy and gradient calculations are performed for alternate locations.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">g_scan</span><span class="phil-words"> = 10 15 20 </span><span class="phil-help">sequence of numbers specifying maxnum_residues_in_cluster for gradient convergence test (mode=gtest), treat as string!</span></li><li class="phil-param" data-expert="0"><span class="phil-name">g_ref</span><span class="phil-words"> = None </span><span class="phil-help">name of the previously save gradient file that is to be used as reference</span></li><li class="phil-param" data-expert="0"><span class="phil-name">g_mode</span><span class="phil-words"> = None </span><span class="phil-help">manual control over gradient test loops (1=standard, 2=standard + point-charges, 3=two buffer 4=two_buffer+ point-charges)</span></li></ul></li><li class="phil-param phil-scope" data-expert="0"><span class="phil-name">quantum</span><ul><li class="phil-param" data-expert="0"><span class="phil-name">engine_name</span><span class="phil-words"> = *mopac ani torchani terachem turbomole pyscf orca gaussian xtb </span><span class="phil-help">choose the QM program</span></li><li class="phil-param" data-expert="0"><span class="phil-name">charge</span><span class="phil-words"> = None </span><span class="phil-help">The formal charge of the entire molecule</span></li><li class="phil-param" data-expert="0"><span class="phil-name">basis</span><span class="phil-words"> = Auto </span><span class="phil-help">pre-defined defaults</span></li><li class="phil-param" data-expert="0"><span class="phil-name">method</span><span class="phil-words"> = Auto </span><span class="phil-help">Defaults to HF for all but MOPAC (PM7), xTB (GFN2) and TorchANI (ani-1x_8x)</span></li><li class="phil-param" data-expert="0"><span class="phil-name">memory</span><span class="phil-words"> = None </span><span class="phil-help">memory for the QM program</span></li><li class="phil-param" data-expert="0"><span class="phil-name">nproc</span><span class="phil-words"> = None </span><span class="phil-help">number of parallel processes for the QM program</span></li><li class="phil-param" data-expert="0"><span class="phil-name">qm_addon</span><span class="phil-words"> = gcp dftd3 gcp-d3 </span><span class="phil-help">allows additional calculations of the gCP and/or DFT-D3 corrections using their stand-alone programs</span></li><li class="phil-param" data-expert="0"><span class="phil-name">qm_addon_method</span><span class="phil-words"> = None </span><span class="phil-help">specifies flags for the qm_addon. See manual for details.</span></li></ul></li><li class="phil-param phil-scope" data-expert="0"><span class="phil-name">refine</span><ul><li class="phil-param" data-expert="0"><span class="phil-name">dry_run</span><span class="phil-words"> = False </span><span class="phil-help">do not perform calculations, only setup steps</span></li><li class="phil-param" data-expert="0"><span class="phil-name">sf_algorithm</span><span class="phil-words"> = *direct fft </span><span class="phil-help">algorithm used to compute structure factors, either the direct method or fast fourier transform.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">refinement_target_name</span><span class="phil-words"> = *ml ls_wunit_k1 </span></li><li class="phil-param" data-expert="0"><span class="phil-name">mode</span><span class="phil-words"> = opt *refine gtest </span><span class="phil-help">choose between refinement, geometry optimization or gradient test</span></li><li class="phil-param" data-expert="0"><span class="phil-name">number_of_macro_cycles</span><span class="phil-words"> = 1 </span><span class="phil-help">number of macro cycles used in the refinement procedure.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">number_of_weight_search_cycles</span><span class="phil-words"> = 50 </span></li><li class="phil-param" data-expert="0"><span class="phil-name">number_of_refine_cycles</span><span class="phil-words"> = 5 </span><span class="phil-help">maximum number of refinement cycles</span></li><li class="phil-param" data-expert="0"><span class="phil-name">number_of_micro_cycles</span><span class="phil-words"> = 50 </span><span class="phil-help">maximum number of micro cycles used in refinement</span></li><li class="phil-param" data-expert="0"><span class="phil-name">data_weight</span><span class="phil-words"> = None </span></li><li class="phil-param" data-expert="0"><span class="phil-name">choose_best_use_r_work</span><span class="phil-words"> = False </span></li><li class="phil-param" data-expert="0"><span class="phil-name">skip_initial_weight_optimization</span><span class="phil-words"> = False </span></li><li class="phil-param" data-expert="0"><span class="phil-name">adjust_restraints_weight_scale_value</span><span class="phil-words"> = 2 </span></li><li class="phil-param" data-expert="0"><span class="phil-name">max_iterations_weight</span><span class="phil-words"> = 50 </span></li><li class="phil-param" data-expert="0"><span class="phil-name">max_iterations_refine</span><span class="phil-words"> = 50 </span></li><li class="phil-param" data-expert="0"><span class="phil-name">use_ase_lbfgs</span><span class="phil-words"> = False </span><span class="phil-help">used for debugging the lbfgs minimizer from cctbx.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">line_search</span><span class="phil-words"> = True </span><span class="phil-help">flag to use a line search in minimizer.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">stpmax</span><span class="phil-words"> = 3 </span><span class="phil-help">maximum step length, empirically we find 3 for cctbx, but 0.2 is better for QM methods.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">gradient_only</span><span class="phil-words"> = False </span><span class="phil-help">use the gradient only line search according to JA Snyman 2005.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">update_all_scales</span><span class="phil-words"> = True </span></li><li class="phil-param" data-expert="0"><span class="phil-name">refine_sites</span><span class="phil-words"> = True </span><span class="phil-help">only refine the cartesian coordinates of the molecular system.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">refine_adp</span><span class="phil-words"> = False </span><span class="phil-help">adp refinement are not currently supported.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">restraints_weight_scale</span><span class="phil-words"> = 1.0 </span></li><li class="phil-param" data-expert="0"><span class="phil-name">shake_sites</span><span class="phil-words"> = False </span></li><li class="phil-param" data-expert="0"><span class="phil-name">use_convergence_test</span><span class="phil-words"> = True </span></li><li class="phil-param" data-expert="0"><span class="phil-name">max_bond_rmsd</span><span class="phil-words"> = 0.03 </span></li><li class="phil-param" data-expert="0"><span class="phil-name">max_r_work_r_free_gap</span><span class="phil-words"> = 5.0 </span></li><li class="phil-param" data-expert="0"><span class="phil-name">r_tolerance</span><span class="phil-words"> = 0.001 </span></li><li class="phil-param" data-expert="0"><span class="phil-name">rmsd_tolerance</span><span class="phil-words"> = 0.01 </span><span class="phil-help">maximum acceptable tolerance for the rmsd.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">opt_log</span><span class="phil-words"> = False </span><span class="phil-help">additional output of the L-BFGS optimizer</span></li><li class="phil-param" data-expert="0"><span class="phil-name">pre_opt</span><span class="phil-words"> = False </span><span class="phil-help">pre-optimization using steepest decent (SD) and conjugate gradient (CG) techniques w/o line search</span></li><li class="phil-param" data-expert="0"><span class="phil-name">pre_opt_stpmax</span><span class="phil-words"> = 0.1 </span><span class="phil-help">step size</span></li><li class="phil-param" data-expert="0"><span class="phil-name">pre_opt_iter</span><span class="phil-words"> = 10 </span><span class="phil-help">max. iterations for pre-optimizer</span></li><li class="phil-param" data-expert="0"><span class="phil-name">pre_opt_switch</span><span class="phil-words"> = 2 </span><span class="phil-help">max. iterations before switching from SD to CG</span></li><li class="phil-param" data-expert="0"><span class="phil-name">pre_opt_gconv</span><span class="phil-words"> = 3000 </span><span class="phil-help">gradient norm convergence threshold for pre-optimizer</span></li></ul></li><li class="phil-param phil-scope" data-expert="0"><span class="phil-name">parallel</span><ul><li class="phil-param" data-expert="0"><span class="phil-name">method</span><span class="phil-words"> = *multiprocessing slurm pbs sge lsf threading </span><span class="phil-help">type of parallel mode and efficient method of processes on the current computer. The others are queueing protocols with the expection of threading which is not a safe choice.</span></li><li class="phil-param" data-expert="0"><span class="phil-name">nproc</span><span class="phil-words"> = None </span><span class="phil-help">Number of processes to use</span></li><li class="phil-param" data-expert="0"><span class="phil-name">qsub_command</span><span class="phil-words"> = None </span><span class="phil-help">Specific command to use on the queue system</span></li></ul></li></ul></p>
</div>
</div>
</div>

  </body>
</html>
