from __future__ import print_function
from __future__ import absolute_import
import os, sys
from qrefine.tests.unit import run_tests
from libtbx import easy_run
import libtbx.load_env

qrefine_path = libtbx.env.find_in_repositories("qrefine")

pdb_lines = '''
CRYST1   28.903   58.916   41.496  90.00  90.00  90.00 P 1
SCALE1      0.034598  0.000000  0.000000        0.00000
SCALE2      0.000000  0.016973  0.000000        0.00000
SCALE3      0.000000  0.000000  0.024099        0.00000
ATOM      1  N   GLY A  87       7.109  12.926   5.576  1.00 80.00           N
ATOM      2  CA  GLY A  87       7.840  12.041   6.465  1.00 80.00           C
ATOM      3  C   GLY A  87       8.271  12.731   7.773  1.00 80.00           C
ATOM      4  O   GLY A  87       8.615  12.020   8.719  1.00 80.00           O
ATOM      5  H1  GLY A  87       7.550  12.998   4.795  1.00 80.00           H
ATOM      6  H2  GLY A  87       6.288  12.590   5.426  1.00 80.00           H
ATOM      7  H3  GLY A  87       7.036  13.739   5.955  1.00 80.00           H
ATOM      8  HA2 GLY A  87       7.287  11.273   6.677  1.00 80.00           H
ATOM      9  HA3 GLY A  87       8.627  11.706   6.006  1.00 80.00           H
ATOM     10  N   GLY A  88       8.311  14.046   7.824  1.00 80.00           N
ATOM     11  CA  GLY A  88       8.924  14.748   8.963  1.00 80.00           C
ATOM     12  C   GLY A  88       8.145  14.441  10.249  1.00 80.00           C
ATOM     13  O   GLY A  88       8.755  14.178  11.288  1.00 80.00           O
ATOM     14  H   GLY A  88       7.992  14.563   7.215  1.00 80.00           H
ATOM     15  HA2 GLY A  88       9.849  14.473   9.063  1.00 80.00           H
ATOM     16  HA3 GLY A  88       8.929  15.704   8.799  1.00 80.00           H
ATOM     17  N   GLY A  89       6.816  14.533  10.216  1.00 80.00           N
ATOM     18  CA  GLY A  89       6.063  14.339  11.454  1.00 80.00           C
ATOM     19  C   GLY A  89       6.267  12.956  11.997  1.00 80.00           C
ATOM     20  O   GLY A  89       6.484  12.771  13.205  1.00 80.00           O
ATOM     21  H   GLY A  89       6.346  14.700   9.516  1.00 80.00           H
ATOM     22  HA2 GLY A  89       6.344  14.993  12.113  1.00 80.00           H
ATOM     23  HA3 GLY A  89       5.119  14.489  11.289  1.00 80.00           H
ATOM     24  N   GLY A  90       6.201  11.944  11.127  1.00 80.00           N
ATOM     25  CA  GLY A  90       6.380  10.588  11.592  1.00 80.00           C
ATOM     26  C   GLY A  90       7.765  10.329  12.140  1.00 80.00           C
ATOM     27  O   GLY A  90       7.932   9.581  13.086  1.00 80.00           O
ATOM     28  H   GLY A  90       6.056  12.028  10.283  1.00 80.00           H
ATOM     29  HA2 GLY A  90       5.724  10.399  12.281  1.00 80.00           H
ATOM     30  HA3 GLY A  90       6.207   9.975  10.860  1.00 80.00           H
ATOM     31  N   GLY A  91       8.780  10.957  11.543  1.00 80.00           N
ATOM     32  CA  GLY A  91      10.141  10.829  12.058  1.00 80.00           C
ATOM     33  C   GLY A  91      10.230  11.420  13.459  1.00 80.00           C
ATOM     34  O   GLY A  91      10.831  10.840  14.371  1.00 80.00           O
ATOM     35  H   GLY A  91       8.702  11.456  10.847  1.00 80.00           H
ATOM     36  HA2 GLY A  91      10.400   9.895  12.077  1.00 80.00           H
ATOM     37  HA3 GLY A  91      10.762  11.284  11.468  1.00 80.00           H
ATOM     38  N   GLY A  92       9.632  12.593  13.642  1.00 80.00           N
ATOM     39  CA  GLY A  92       9.634  13.216  14.955  1.00 80.00           C
ATOM     40  C   GLY A  92       8.870  12.343  15.950  1.00 80.00           C
ATOM     41  O   GLY A  92       9.337  12.131  17.071  1.00 80.00           O
ATOM     42  H   GLY A  92       9.226  13.037  13.028  1.00 80.00           H
ATOM     43  HA2 GLY A  92      10.546  13.343  15.259  1.00 80.00           H
ATOM     44  HA3 GLY A  92       9.226  14.095  14.905  1.00 80.00           H
ATOM     45  N   GLY A  93       7.711  11.835  15.530  1.00 80.00           N
ATOM     46  CA  GLY A  93       6.915  11.011  16.422  1.00 80.00           C
ATOM     47  C   GLY A  93       7.606   9.711  16.796  1.00 80.00           C
ATOM     48  O   GLY A  93       7.431   9.245  17.928  1.00 80.00           O
ATOM     49  H   GLY A  93       7.377  11.955  14.747  1.00 80.00           H
ATOM     50  HA2 GLY A  93       6.719  11.512  17.229  1.00 80.00           H
ATOM     51  HA3 GLY A  93       6.066  10.811  15.999  1.00 80.00           H
ATOM     73  N  BTYR A  94       8.479   9.112  15.882  0.50 80.00           N
ATOM     74  CA BTYR A  94       9.232   7.915  16.248  0.50 80.00           C
ATOM     75  C  BTYR A  94      10.258   8.233  17.325  0.50 80.00           C
ATOM     76  O  BTYR A  94      10.405   7.506  18.293  0.50 80.00           O
ATOM     77  CB BTYR A  94       9.921   7.315  15.022  0.50 30.00           C
ATOM     78  CG BTYR A  94      10.801   6.124  15.334  0.50 30.00           C
ATOM     79  CD1BTYR A  94      10.247   4.873  15.580  0.50 30.00           C
ATOM     80  CD2BTYR A  94      12.182   6.252  15.381  0.50 30.00           C
ATOM     81  CE1BTYR A  94      11.047   3.784  15.865  0.50 30.00           C
ATOM     82  CE2BTYR A  94      12.990   5.166  15.666  0.50 30.00           C
ATOM     83  CZ BTYR A  94      12.418   3.936  15.907  0.50 30.00           C
ATOM     84  OH BTYR A  94      13.216   2.852  16.193  0.50 30.00           O
ATOM     85  H  BTYR A  94       8.620   9.399  15.084  0.50 80.00           H
ATOM     86  HA BTYR A  94       8.607   7.263  16.601  0.50 80.00           H
ATOM     87  HB2BTYR A  94       9.244   7.047  14.381  0.50 30.00           H
ATOM     88  HB3BTYR A  94      10.459   8.001  14.596  0.50 30.00           H
ATOM     89  HD1BTYR A  94       9.323   4.768  15.552  0.50 30.00           H
ATOM     90  HD2BTYR A  94      12.570   7.081  15.218  0.50 30.00           H
ATOM     91  HE1BTYR A  94      10.664   2.952  16.028  0.50 30.00           H
ATOM     92  HE2BTYR A  94      13.914   5.266  15.695  0.50 30.00           H
ATOM     93  HH BTYR A  94      14.022   3.087  16.184  0.50 30.00           H
ATOM     94  N   GLY A  95      10.862   9.366  17.148  1.00 80.00           N
ATOM     95  CA  GLY A  95      11.781   9.803  18.178  1.00 80.00           C
ATOM     96  C   GLY A  95      11.049  10.057  19.501  1.00 80.00           C
ATOM     97  O   GLY A  95      11.541   9.637  20.558  1.00 80.00           O
ATOM     98  HA2 GLY A  95      12.468   9.131  18.309  1.00 80.00           H
ATOM     99  HA3 GLY A  95      12.229  10.614  17.892  1.00 80.00           H
ATOM    101  H  BGLY A  95      10.769   9.889  16.472  0.50 80.00           H
ATOM    102  N   GLY A  96       9.911  10.747  19.468  1.00 80.00           N
ATOM    103  CA  GLY A  96       9.163  10.978  20.691  1.00 80.00           C
ATOM    104  C   GLY A  96       8.756   9.674  21.361  1.00 80.00           C
ATOM    105  O   GLY A  96       8.867   9.509  22.570  1.00 80.00           O
ATOM    106  H   GLY A  96       9.562  11.084  18.757  1.00 80.00           H
ATOM    107  HA2 GLY A  96       9.701  11.503  21.305  1.00 80.00           H
ATOM    108  HA3 GLY A  96       8.370  11.500  20.491  1.00 80.00           H
ATOM    109  N   GLY A  97       8.248   8.738  20.562  1.00 80.00           N
ATOM    110  CA  GLY A  97       7.821   7.470  21.097  1.00 80.00           C
ATOM    111  C   GLY A  97       8.991   6.708  21.728  1.00 80.00           C
ATOM    112  O   GLY A  97       8.885   6.147  22.814  1.00 80.00           O
ATOM    113  H   GLY A  97       8.146   8.826  19.713  1.00 80.00           H
ATOM    114  HA2 GLY A  97       7.130   7.614  21.762  1.00 80.00           H
ATOM    115  HA3 GLY A  97       7.427   6.935  20.390  1.00 80.00           H
ATOM    116  N   GLY A  98      10.140   6.707  21.049  1.00 80.00           N
ATOM    117  CA  GLY A  98      11.322   6.042  21.575  1.00 80.00           C
ATOM    118  C   GLY A  98      11.839   6.681  22.835  1.00 80.00           C
ATOM    119  O   GLY A  98      12.253   6.004  23.783  1.00 80.00           O
ATOM    120  H   GLY A  98      10.251   7.086  20.285  1.00 80.00           H
ATOM    121  HA2 GLY A  98      11.113   5.112  21.752  1.00 80.00           H
ATOM    122  HA3 GLY A  98      12.020   6.053  20.902  1.00 80.00           H
ATOM    123  N   GLY A  99      11.875   8.002  22.899  1.00 80.00           N
ATOM    124  CA  GLY A  99      12.354   8.727  24.053  1.00 80.00           C
ATOM    125  C   GLY A  99      11.365   8.788  25.232  1.00 80.00           C
ATOM    126  O   GLY A  99      11.719   9.291  26.291  1.00 80.00           O
ATOM    127  OXT GLY A  99      10.140   8.286  25.083  1.00 80.00           O
ATOM    128  H   GLY A  99      11.615   8.511  22.256  1.00 80.00           H
ATOM    129  HA2 GLY A  99      13.178   8.316  24.359  1.00 80.00           H
ATOM    130  HA3 GLY A  99      12.572   9.633  23.783  1.00 80.00           H
TER
'''

expansion = '''
CRYST1   18.273   20.824   31.291  90.00  90.00  90.00 P 1
SCALE1      0.054726  0.000000  0.000000        0.00000
SCALE2      0.000000  0.048022  0.000000        0.00000
SCALE3      0.000000  0.000000  0.031958        0.00000
ATOM      1  N   GLY A  87       7.109  12.926   5.576  1.00 80.00           N
ATOM      2  CA  GLY A  87       7.840  12.041   6.465  1.00 80.00           C
ATOM      3  C   GLY A  87       8.271  12.731   7.773  1.00 80.00           C
ATOM      4  O   GLY A  87       8.615  12.020   8.719  1.00 80.00           O
ATOM      5  H1  GLY A  87       7.550  12.998   4.795  1.00 80.00           H
ATOM      6  H2  GLY A  87       6.288  12.590   5.426  1.00 80.00           H
ATOM      7  H3  GLY A  87       7.036  13.739   5.955  1.00 80.00           H
ATOM      8  HA2 GLY A  87       7.287  11.273   6.677  1.00 80.00           H
ATOM      9  HA3 GLY A  87       8.627  11.706   6.006  1.00 80.00           H
ATOM     10  N   GLY A  88       8.311  14.046   7.824  1.00 80.00           N
ATOM     11  CA  GLY A  88       8.924  14.748   8.963  1.00 80.00           C
ATOM     12  C   GLY A  88       8.145  14.441  10.249  1.00 80.00           C
ATOM     13  O   GLY A  88       8.755  14.178  11.288  1.00 80.00           O
ATOM     14  H   GLY A  88       7.992  14.563   7.215  1.00 80.00           H
ATOM     15  HA2 GLY A  88       9.849  14.473   9.063  1.00 80.00           H
ATOM     16  HA3 GLY A  88       8.929  15.704   8.799  1.00 80.00           H
ATOM     17  N   GLY A  89       6.816  14.533  10.216  1.00 80.00           N
ATOM     18  CA  GLY A  89       6.063  14.339  11.454  1.00 80.00           C
ATOM     19  C   GLY A  89       6.267  12.956  11.997  1.00 80.00           C
ATOM     20  O   GLY A  89       6.484  12.771  13.205  1.00 80.00           O
ATOM     21  H   GLY A  89       6.346  14.700   9.516  1.00 80.00           H
ATOM     22  HA2 GLY A  89       6.344  14.993  12.113  1.00 80.00           H
ATOM     23  HA3 GLY A  89       5.119  14.489  11.289  1.00 80.00           H
ATOM     24  N   GLY A  90       6.201  11.944  11.127  1.00 80.00           N
ATOM     25  CA  GLY A  90       6.380  10.588  11.592  1.00 80.00           C
ATOM     26  C   GLY A  90       7.765  10.329  12.140  1.00 80.00           C
ATOM     27  O   GLY A  90       7.932   9.581  13.086  1.00 80.00           O
ATOM     28  H   GLY A  90       6.056  12.028  10.283  1.00 80.00           H
ATOM     29  HA2 GLY A  90       5.724  10.399  12.281  1.00 80.00           H
ATOM     30  HA3 GLY A  90       6.207   9.975  10.860  1.00 80.00           H
ATOM     31  N   GLY A  91       8.780  10.957  11.543  1.00 80.00           N
ATOM     32  CA  GLY A  91      10.141  10.829  12.058  1.00 80.00           C
ATOM     33  C   GLY A  91      10.230  11.420  13.459  1.00 80.00           C
ATOM     34  O   GLY A  91      10.831  10.840  14.371  1.00 80.00           O
ATOM     35  H   GLY A  91       8.702  11.456  10.847  1.00 80.00           H
ATOM     36  HA2 GLY A  91      10.400   9.895  12.077  1.00 80.00           H
ATOM     37  HA3 GLY A  91      10.762  11.284  11.468  1.00 80.00           H
ATOM     38  N   GLY A  92       9.632  12.593  13.642  1.00 80.00           N
ATOM     39  CA  GLY A  92       9.634  13.216  14.955  1.00 80.00           C
ATOM     40  C   GLY A  92       8.870  12.343  15.950  1.00 80.00           C
ATOM     41  O   GLY A  92       9.337  12.131  17.071  1.00 80.00           O
ATOM     42  H   GLY A  92       9.226  13.037  13.028  1.00 80.00           H
ATOM     43  HA2 GLY A  92      10.546  13.343  15.259  1.00 80.00           H
ATOM     44  HA3 GLY A  92       9.226  14.095  14.905  1.00 80.00           H
ATOM     45  N   GLY A  93       7.711  11.835  15.530  1.00 80.00           N
ATOM     46  CA  GLY A  93       6.915  11.011  16.422  1.00 80.00           C
ATOM     47  C   GLY A  93       7.606   9.711  16.796  1.00 80.00           C
ATOM     48  O   GLY A  93       7.431   9.245  17.928  1.00 80.00           O
ATOM     49  H   GLY A  93       7.377  11.955  14.747  1.00 80.00           H
ATOM     50  HA2 GLY A  93       6.719  11.512  17.229  1.00 80.00           H
ATOM     51  HA3 GLY A  93       6.066  10.811  15.999  1.00 80.00           H
ATOM     52  N  ATYR A  94       8.379   9.112  15.882  0.50 80.00           N
ATOM     53  CA ATYR A  94       9.132   7.915  16.248  0.50 80.00           C
ATOM     54  C  ATYR A  94      10.158   8.233  17.325  0.50 80.00           C
ATOM     55  O  ATYR A  94      10.305   7.506  18.293  0.50 80.00           O
ATOM     56  CB ATYR A  94       9.821   7.315  15.022  0.50 30.00           C
ATOM     57  CG ATYR A  94       8.864   6.790  13.975  0.50 30.00           C
ATOM     58  CD1ATYR A  94       8.372   5.492  14.045  0.50 30.00           C
ATOM     59  CD2ATYR A  94       8.453   7.592  12.920  0.50 30.00           C
ATOM     60  CE1ATYR A  94       7.498   5.009  13.091  0.50 30.00           C
ATOM     61  CE2ATYR A  94       7.577   7.117  11.960  0.50 30.00           C
ATOM     62  CZ ATYR A  94       7.103   5.826  12.051  0.50 30.00           C
ATOM     63  OH ATYR A  94       6.234   5.346  11.098  0.50 30.00           O
ATOM     64  H  ATYR A  94       8.477   9.376  15.069  0.50 80.00           H
ATOM     65  HA ATYR A  94       8.507   7.263  16.601  0.50 80.00           H
ATOM     66  HB2ATYR A  94      10.389   7.990  14.619  0.50 30.00           H
ATOM     67  HB3ATYR A  94      10.400   6.592  15.309  0.50 30.00           H
ATOM     68  HD1ATYR A  94       8.636   4.940  14.745  0.50 30.00           H
ATOM     69  HD2ATYR A  94       8.772   8.463  12.857  0.50 30.00           H
ATOM     70  HE1ATYR A  94       7.177   4.138  13.149  0.50 30.00           H
ATOM     71  HE2ATYR A  94       7.310   7.665  11.258  0.50 30.00           H
ATOM     72  HH ATYR A  94       6.081   5.946  10.530  0.50 30.00           H
ATOM     73  N  BTYR A  94       8.479   9.112  15.882  0.50 80.00           N
ATOM     74  CA BTYR A  94       9.232   7.915  16.248  0.50 80.00           C
ATOM     75  C  BTYR A  94      10.258   8.233  17.325  0.50 80.00           C
ATOM     76  O  BTYR A  94      10.405   7.506  18.293  0.50 80.00           O
ATOM     77  CB BTYR A  94       9.921   7.315  15.022  0.50 30.00           C
ATOM     78  CG BTYR A  94      10.801   6.124  15.334  0.50 30.00           C
ATOM     79  CD1BTYR A  94      10.247   4.873  15.580  0.50 30.00           C
ATOM     80  CD2BTYR A  94      12.182   6.252  15.381  0.50 30.00           C
ATOM     81  CE1BTYR A  94      11.047   3.784  15.865  0.50 30.00           C
ATOM     82  CE2BTYR A  94      12.990   5.166  15.666  0.50 30.00           C
ATOM     83  CZ BTYR A  94      12.418   3.936  15.907  0.50 30.00           C
ATOM     84  OH BTYR A  94      13.216   2.852  16.193  0.50 30.00           O
ATOM     85  H  BTYR A  94       8.620   9.399  15.084  0.50 80.00           H
ATOM     86  HA BTYR A  94       8.607   7.263  16.601  0.50 80.00           H
ATOM     87  HB2BTYR A  94       9.244   7.047  14.381  0.50 30.00           H
ATOM     88  HB3BTYR A  94      10.459   8.001  14.596  0.50 30.00           H
ATOM     89  HD1BTYR A  94       9.323   4.768  15.552  0.50 30.00           H
ATOM     90  HD2BTYR A  94      12.570   7.081  15.218  0.50 30.00           H
ATOM     91  HE1BTYR A  94      10.664   2.952  16.028  0.50 30.00           H
ATOM     92  HE2BTYR A  94      13.914   5.266  15.695  0.50 30.00           H
ATOM     93  HH BTYR A  94      14.022   3.087  16.184  0.50 30.00           H
ATOM     94  N   GLY A  95      10.862   9.366  17.148  1.00 80.00           N
ATOM     95  CA  GLY A  95      11.781   9.803  18.178  1.00 80.00           C
ATOM     96  C   GLY A  95      11.049  10.057  19.501  1.00 80.00           C
ATOM     97  O   GLY A  95      11.541   9.637  20.558  1.00 80.00           O
ATOM     98  HA2 GLY A  95      12.468   9.131  18.309  1.00 80.00           H
ATOM     99  HA3 GLY A  95      12.229  10.614  17.892  1.00 80.00           H
ATOM    100  H  AGLY A  95      10.815   9.873  16.455  0.50 80.00           H
ATOM    101  H  BGLY A  95      10.769   9.889  16.472  0.50 80.00           H
ATOM    102  N   GLY A  96       9.911  10.747  19.468  1.00 80.00           N
ATOM    103  CA  GLY A  96       9.163  10.978  20.691  1.00 80.00           C
ATOM    104  C   GLY A  96       8.756   9.674  21.361  1.00 80.00           C
ATOM    105  O   GLY A  96       8.867   9.509  22.570  1.00 80.00           O
ATOM    106  H   GLY A  96       9.562  11.084  18.757  1.00 80.00           H
ATOM    107  HA2 GLY A  96       9.701  11.503  21.305  1.00 80.00           H
ATOM    108  HA3 GLY A  96       8.370  11.500  20.491  1.00 80.00           H
ATOM    109  N   GLY A  97       8.248   8.738  20.562  1.00 80.00           N
ATOM    110  CA  GLY A  97       7.821   7.470  21.097  1.00 80.00           C
ATOM    111  C   GLY A  97       8.991   6.708  21.728  1.00 80.00           C
ATOM    112  O   GLY A  97       8.885   6.147  22.814  1.00 80.00           O
ATOM    113  H   GLY A  97       8.146   8.826  19.713  1.00 80.00           H
ATOM    114  HA2 GLY A  97       7.130   7.614  21.762  1.00 80.00           H
ATOM    115  HA3 GLY A  97       7.427   6.935  20.390  1.00 80.00           H
ATOM    116  N   GLY A  98      10.140   6.707  21.049  1.00 80.00           N
ATOM    117  CA  GLY A  98      11.322   6.042  21.575  1.00 80.00           C
ATOM    118  C   GLY A  98      11.839   6.681  22.835  1.00 80.00           C
ATOM    119  O   GLY A  98      12.253   6.004  23.783  1.00 80.00           O
ATOM    120  H   GLY A  98      10.251   7.086  20.285  1.00 80.00           H
ATOM    121  HA2 GLY A  98      11.113   5.112  21.752  1.00 80.00           H
ATOM    122  HA3 GLY A  98      12.020   6.053  20.902  1.00 80.00           H
ATOM    123  N   GLY A  99      11.875   8.002  22.899  1.00 80.00           N
ATOM    124  CA  GLY A  99      12.354   8.727  24.053  1.00 80.00           C
ATOM    125  C   GLY A  99      11.365   8.788  25.232  1.00 80.00           C
ATOM    126  O   GLY A  99      11.719   9.291  26.291  1.00 80.00           O
ATOM    127  OXT GLY A  99      10.140   8.286  25.083  1.00 80.00           O
ATOM    128  H   GLY A  99      11.615   8.511  22.256  1.00 80.00           H
ATOM    129  HA2 GLY A  99      13.178   8.316  24.359  1.00 80.00           H
ATOM    130  HA3 GLY A  99      12.572   9.633  23.783  1.00 80.00           H
TER
ATOM     10  N   GLYSS   0       8.311  -6.778   7.824  1.00 80.00           N
ATOM     11  CA  GLYSS   0       8.924  -6.076   8.963  1.00 80.00           C
ATOM     12  C   GLYSS   0       8.145  -6.383  10.249  1.00 80.00           C
ATOM     13  O   GLYSS   0       8.755  -6.646  11.288  1.00 80.00           O
ATOM     14  H   GLYSS   0       7.992  -6.261   7.215  1.00 80.00           H
ATOM     15  HA2 GLYSS   0       9.849  -6.351   9.063  1.00 80.00           H
ATOM     16  HA3 GLYSS   0       8.929  -5.120   8.799  1.00 80.00           H
ATOM     17  N   GLYSS   1       6.816  -6.291  10.216  1.00 80.00           N
ATOM     18  CA  GLYSS   1       6.063  -6.485  11.454  1.00 80.00           C
ATOM     19  C   GLYSS   1       6.267  -7.868  11.997  1.00 80.00           C
ATOM     20  O   GLYSS   1       6.484  -8.053  13.205  1.00 80.00           O
ATOM     21  H   GLYSS   1       6.346  -6.124   9.516  1.00 80.00           H
ATOM     22  HA2 GLYSS   1       6.344  -5.831  12.113  1.00 80.00           H
ATOM     23  HA3 GLYSS   1       5.119  -6.335  11.289  1.00 80.00           H
ATOM     38  N   GLYSS   2       9.632  -8.231  13.642  1.00 80.00           N
ATOM     39  CA  GLYSS   2       9.634  -7.608  14.955  1.00 80.00           C
ATOM     40  C   GLYSS   2       8.870  -8.481  15.950  1.00 80.00           C
ATOM     41  O   GLYSS   2       9.337  -8.693  17.071  1.00 80.00           O
ATOM     42  H   GLYSS   2       9.226  -7.787  13.028  1.00 80.00           H
ATOM     43  HA2 GLYSS   2      10.546  -7.481  15.259  1.00 80.00           H
ATOM     44  HA3 GLYSS   2       9.226  -6.729  14.905  1.00 80.00           H
ATOM     52  N  ATYRSS   3       8.379  29.936  15.882  0.50 80.00           N
ATOM     53  CA ATYRSS   3       9.132  28.739  16.248  0.50 80.00           C
ATOM     54  C  ATYRSS   3      10.158  29.057  17.325  0.50 80.00           C
ATOM     55  O  ATYRSS   3      10.305  28.330  18.293  0.50 80.00           O
ATOM     56  CB ATYRSS   3       9.821  28.139  15.022  0.50 30.00           C
ATOM     57  CG ATYRSS   3       8.864  27.614  13.975  0.50 30.00           C
ATOM     58  CD1ATYRSS   3       8.372  26.316  14.045  0.50 30.00           C
ATOM     59  CD2ATYRSS   3       8.453  28.416  12.920  0.50 30.00           C
ATOM     60  CE1ATYRSS   3       7.498  25.833  13.091  0.50 30.00           C
ATOM     61  CE2ATYRSS   3       7.577  27.941  11.960  0.50 30.00           C
ATOM     62  CZ ATYRSS   3       7.103  26.650  12.051  0.50 30.00           C
ATOM     63  OH ATYRSS   3       6.234  26.170  11.098  0.50 30.00           O
ATOM     64  H  ATYRSS   3       8.477  30.200  15.069  0.50 80.00           H
ATOM     65  HA ATYRSS   3       8.507  28.087  16.601  0.50 80.00           H
ATOM     66  HB2ATYRSS   3      10.389  28.814  14.619  0.50 30.00           H
ATOM     67  HB3ATYRSS   3      10.400  27.416  15.309  0.50 30.00           H
ATOM     68  HD1ATYRSS   3       8.636  25.764  14.745  0.50 30.00           H
ATOM     69  HD2ATYRSS   3       8.772  29.287  12.857  0.50 30.00           H
ATOM     70  HE1ATYRSS   3       7.177  24.962  13.149  0.50 30.00           H
ATOM     71  HE2ATYRSS   3       7.310  28.489  11.258  0.50 30.00           H
ATOM     72  HH ATYRSS   3       6.081  26.770  10.530  0.50 30.00           H
ATOM     73  N  BTYRSS   3       8.479  29.936  15.882  0.50 80.00           N
ATOM     74  CA BTYRSS   3       9.232  28.739  16.248  0.50 80.00           C
ATOM     75  C  BTYRSS   3      10.258  29.057  17.325  0.50 80.00           C
ATOM     76  O  BTYRSS   3      10.405  28.330  18.293  0.50 80.00           O
ATOM     77  CB BTYRSS   3       9.921  28.139  15.022  0.50 30.00           C
ATOM     78  CG BTYRSS   3      10.801  26.948  15.334  0.50 30.00           C
ATOM     79  CD1BTYRSS   3      10.247  25.697  15.580  0.50 30.00           C
ATOM     80  CD2BTYRSS   3      12.182  27.076  15.381  0.50 30.00           C
ATOM     81  CE1BTYRSS   3      11.047  24.608  15.865  0.50 30.00           C
ATOM     82  CE2BTYRSS   3      12.990  25.990  15.666  0.50 30.00           C
ATOM     83  CZ BTYRSS   3      12.418  24.760  15.907  0.50 30.00           C
ATOM     84  OH BTYRSS   3      13.216  23.676  16.193  0.50 30.00           O
ATOM     85  H  BTYRSS   3       8.620  30.223  15.084  0.50 80.00           H
ATOM     86  HA BTYRSS   3       8.607  28.087  16.601  0.50 80.00           H
ATOM     87  HB2BTYRSS   3       9.244  27.871  14.381  0.50 30.00           H
ATOM     88  HB3BTYRSS   3      10.459  28.825  14.596  0.50 30.00           H
ATOM     89  HD1BTYRSS   3       9.323  25.592  15.552  0.50 30.00           H
ATOM     90  HD2BTYRSS   3      12.570  27.905  15.218  0.50 30.00           H
ATOM     91  HE1BTYRSS   3      10.664  23.776  16.028  0.50 30.00           H
ATOM     92  HE2BTYRSS   3      13.914  26.090  15.695  0.50 30.00           H
ATOM     93  HH BTYRSS   3      14.022  23.911  16.184  0.50 30.00           H
TER
'''

def run(prefix):
  fn='expansion.pdb'
  f=open(fn, 'w')
  f.write(expansion)
  f.close()
  fn='test_alt_loc_original.pdb'
  f=open(fn, 'w')
  f.write(pdb_lines)
  f.close()
  cmd = 'qrefine.python %s/completion.py %s model_completion=False original_pdb_filename=expansion.pdb' % (qrefine_path, fn)
  if 0: print(cmd)
  easy_run.go(cmd)
  fnc = '%s_capping.pdb' % fn.replace('.pdb','')
  cmd = 'mmtbx.pdb_interpretation %s' % fnc
  if 0: print(cmd)
  rc = easy_run.go(cmd)
  assert '     H      47      1.00' in rc.stdout_lines
  os.remove(fn)
  os.remove(fnc)
  return rc

if(__name__=='__main__'):
  prefix = os.path.basename(__file__).replace(".py","")
  run_tests.runner(function=run, prefix=prefix, disable=True)
